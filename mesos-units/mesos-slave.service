[Unit]
Description=Mesos Slave
After=skydns.service
After=docker.servicee
After=mesos-master.service
Requires=skydns.service
Requires=docker.service
Requires=mesos-master.service

[Service]
EnvironmentFile=/etc/environment
Environment=ENV=drewfus
Environment=CLUSTER=dev

Type=notify
NotifyAccess=all

Restart=always
RestartSec=10s

TimeoutStartSec=0
TimeoutStopSec=15

# configure host storage directory
ExecStartPre=/usr/bin/mkdir -p /data/mesos-slave/${CLUSTER}/${ENV}/log

# pull app docker image
ExecStartPre=/usr/bin/docker pull andrewrothstein/docker-mesos

# install systemd-docker
ExecStartPre=/usr/bin/docker run --rm -v /opt/bin:/opt/bin ibuildthecloud/systemd-docker

ExecStart=/opt/bin/systemd-docker run --rm \
 --name mesos-slave \
 --dns=${COREOS_PRIVATE_IPV4} \
 --dns-search=${CLUSTER}.${ENV}.local \
 andrewrothstein/docker-mesos mesos-master \
  --log_dir=/data/mesos-master/${CLUSTER}/${ENV}/log \
  --zk=zk://zookeeper.${CLUSTER}.${ENV}.local:2181/mesos/${CLUSTER}/${ENV}

[Install]
WantedBy=multi-user.target

[X-Fleet]
Global=true
